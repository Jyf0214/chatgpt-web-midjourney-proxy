var we=Object.defineProperty;var $e=(l,e,t)=>e in l?we(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var te=(l,e,t)=>($e(l,typeof e!="symbol"?e+"":e,t),t);import{m as D,G as h,b1 as q,aY as R,b9 as oe,d as M,r as I,X as J,S as X,l as Y,Z as z,o,c as d,a,b as y,J as m,N as K,a4 as $,_ as S,$ as g,aR as Z,W as b,b3 as G,I as L,ae as Q,ab as N,a5 as A,Y as O,aO as B,ba as H,O as U,a3 as ee,a1 as le,ac as ve,bb as ae,b2 as F,b5 as me,b7 as ie,bc as be,a8 as xe,a9 as De,u as je,bd as Ie,be as Re,a2 as Se,al as Ce}from"./index-b574640b.js";import{l as _e,a as fe}from"./lumaStore-af1c3abe.js";import{N as pe}from"./Switch-a0db0e58.js";import{N as ge}from"./ButtonGroup-eeb662e4.js";function Ee(){let l={};if(h.myData.vtoken){const t={"x-vtoken":h.myData.vtoken,"x-ctoken":h.myData.ctoken};l={...l,...t}}if(!R.myData.LUMA_KEY){const t=oe();if(t.token){const s={"x-ptoken":t.token};return l={...l,...s},l}return l}const e={Authorization:"Bearer "+R.myData.LUMA_KEY};return l={...l,...e},l}const Oe=l=>{if(l.indexOf("http")==0)return l;const e=l.indexOf("/pro")>-1?"/pro":"";return l=l.replaceAll("/pro",""),R.myData.LUMA_SERVER?R.myData.LUMA_SERVER.indexOf("/pro")>0?`${R.myData.LUMA_SERVER}/luma${l}`:`${R.myData.LUMA_SERVER}${e}/luma${l}`:`${e}/luma${l}`},ne=(l,e,t)=>{D("sunoFetch",l);let s={"Content-Type":"application/json"};return t&&t.headers&&(s=t.headers),s={...s,...Ee()},new Promise((w,u)=>{let _={method:"GET"};_.headers=s,t!=null&&t.upFile?(_.method="POST",_.body=e):e&&(_.body=JSON.stringify(e),_.method="POST"),fetch(Oe(l),_).then(async r=>{var j;if(!r.ok){let p="发生错误: "+r.status;try{let v=await r.json();p="("+r.status+")发生错误: "+(((j=v==null?void 0:v.error)==null?void 0:j.message)??"")}catch{}throw h.myData.ms&&h.myData.ms.error(p),new Error(p)}r.json().then(p=>w(p)).catch(p=>{h.myData.ms&&h.myData.ms.error("发生错误"+p),u(p)})}).catch(r=>{r.name==="TypeError"&&r.message==="Failed to fetch"?h.myData.ms&&h.myData.ms.error("跨域|CORS error"):h.myData.ms&&h.myData.ms.error("发生错误:"+r),D("e",r.stat),u(r)})})},ye=async l=>{var w;if(l=="")return"";const e=new _e,s=new fe().getOneById(l);for(let u=0;u<120;u++){let _="/generations/"+l;s&&s.isHK&&(_="/pro/generations/"+l);let r=await ne(_);if(r.id&&(r.last_feed=new Date().getTime(),e.save(r),h.setMyData({act:"FeedLumaTask"}),r.state=="completed"&&r.video&&((w=r.video)!=null&&w.download_url)))break;await q(5*1e3)}},Te={class:"p-2"},Le={class:"pt-1"},Ae={class:"flex justify-between items-center"},Ue={key:0,class:"pt-1"},Me={class:"flex justify-between items-center"},Ve={class:"line-clamp-1"},ze={class:"max-w-[300px]"},Ne={class:"relative flex items-center justify-center bg-white bg-opacity-10 rounded-[5px] overflow-hidden aspect-[16/8.85]"},Fe=["src"],Ge={key:1,class:"pt-1"},Ke={class:"pt-1"},Pe={class:"flex justify-start items-end"},Be=["src"],Ye={key:1,class:"text-center"},He={class:"pl-2"},We=["src"],qe={key:1,class:"text-center"},Je={class:"pt-1"},Xe={class:"flex justify-between items-end"},Ze={class:"pb-1 text-right"},Qe=["innerHTML"],et=M({__name:"lumaInput",setup(l){const e=I({aspect_ratio:"16:9",loop:!1,expand_prompt:!0,image_url:"",user_prompt:"",image_end_url:""}),t=I({isDo:!1,version:"relax"}),s=J(),w=I(),u=I(),_=I();X(()=>{h.setMyData({ms:s}),t.value.version=R.myData.IS_LUMA_PRO?"pro":"relax"});const r=Y(()=>e.value.user_prompt!=""&&!t.value.isDo),j=async()=>{if(D("generate",e.value),t.value.isDo=!0,!r){s.error(O("video.plsInput"));return}try{let i="/generations/";_.value&&(i=`/generations/${_.value.id}/extend`);const f=h.myData.is_luma_pro;f&&(i="/pro"+i);const C=await ne(i,e.value);D("d",C);const E=C.id??C[0].id;f&&new fe().save({id:E,isHK:!0}),s.success(O("video.submitSuccess")),await q(500),ye(E)}catch{}t.value.isDo=!1};function p(i){B(i.target.files[0]).then(f=>{e.value.image_url=f,w.value=""}).catch(f=>s.error(f))}function v(i){B(i.target.files[0]).then(f=>{e.value.image_end_url=f,u.value=""}).catch(f=>s.error(f))}const x=()=>{e.value.user_prompt="",e.value.image_url="",e.value.image_end_url="",_.value=void 0};z(()=>h.myData.act,i=>{if(i=="luma.extend"){D("luma.extend",h.myData.actData);const f=h.myData.actData;_.value=f}});const c=Y(()=>{const i=R.myData.LUMA_SERVER.toLocaleLowerCase();return i!=""?i.indexOf("hk")>-1&&i.indexOf("pro")==-1:h.myData.session&&h.myData.session.isHk}),k=i=>{h.setMyData({is_luma_pro:i}),R.setMyData({IS_LUMA_PRO:i})};z(()=>c.value,i=>k(i&&t.value.version=="pro")),z(()=>t.value.version,()=>k(c.value&&t.value.version=="pro"));const n=[{label:"版本: relax, 价格实惠",value:"relax"},{label:"版本: pro, 快且无水印",value:"pro"}];return(i,f)=>{var C,E,V,P,ue;return o(),d("div",Te,[a("div",null,[y(m(K),{value:e.value.user_prompt,"onUpdate:value":f[0]||(f[0]=T=>e.value.user_prompt=T),placeholder:i.$t("video.descpls"),type:"textarea",size:"small",autosize:{minRows:3,maxRows:12}},null,8,["value","placeholder"])]),a("div",Le,[a("div",Ae,[a("div",null,[y(m(pe),{value:e.value.expand_prompt,"onUpdate:value":f[1]||(f[1]=T=>e.value.expand_prompt=T),size:"small"},{checked:$(()=>[S(" Enhance prompt ")]),unchecked:$(()=>[S(" Enhance prompt ")]),_:1},8,["value"])]),a("div",null,[y(m(pe),{value:e.value.loop,"onUpdate:value":f[2]||(f[2]=T=>e.value.loop=T),size:"small"},{checked:$(()=>[S(" Loop ")]),unchecked:$(()=>[S(" Loop ")]),_:1},8,["value"])])])]),_.value?(o(),d("div",Ue,[a("div",Me,[a("div",null,[y(m(Z),{trigger:"hover"},{trigger:$(()=>[a("div",Ve,g(i.$t("video.extend"))+":"+g(_.value.prompt),1)]),default:$(()=>[a("div",ze,g(_.value.prompt),1)]),_:1})])]),a("div",Ne,[(C=_.value.video)!=null&&C.url||(E=_.value.video)!=null&&E.download_url?(o(),d("video",{key:0,src:(V=_.value.video)!=null&&V.download_url?(P=_.value.video)==null?void 0:P.download_url:(ue=_.value.video)==null?void 0:ue.url,onError:f[3]||(f[3]=T=>{var ce;return T.target.src=(ce=_.value.video)==null?void 0:ce.url}),loop:"",playsinline:"",controls:"",class:"w-full h-full object-cover"},null,40,Fe)):b("",!0)])])):b("",!0),m(c)?(o(),d("div",Ge,[y(m(G),{value:t.value.version,"onUpdate:value":f[4]||(f[4]=T=>t.value.version=T),options:n,size:"small"},null,8,["value"])])):b("",!0),a("div",Ke,[a("div",Pe,[a("div",null,[a("input",{type:"file",onChange:p,ref_key:"fsRef",ref:w,style:{display:"none"},accept:"image/jpeg, image/jpg, image/png, image/gif"},null,544),a("div",{class:"h-[80px] w-[80px] overflow-hidden rounded-sm border border-gray-400/20 flex justify-center items-center cursor-pointer",onClick:f[5]||(f[5]=T=>w.value.click())},[e.value.image_url?(o(),d("img",{key:0,src:e.value.image_url},null,8,Be)):(o(),d("div",Ye,g(i.$t("video.selectimg")),1))])]),a("div",He,[a("input",{type:"file",onChange:v,ref_key:"fsRef2",ref:u,style:{display:"none"},accept:"image/jpeg, image/jpg, image/png, image/gif"},null,544),a("div",{class:"h-[80px] w-[80px] overflow-hidden rounded-sm border border-gray-400/20 flex justify-center items-center cursor-pointer",onClick:f[6]||(f[6]=T=>u.value.click())},[e.value.image_end_url?(o(),d("img",{key:0,src:e.value.image_end_url},null,8,We)):(o(),d("div",qe,g(i.$t("video.endImg")),1))])])])]),a("div",Je,[a("div",Xe,[a("div",Ze,[_.value||e.value.user_prompt!=""||e.value.image_url!=""||e.value.image_end_url!=""?(o(),L(m(Q),{key:0,type:"success",size:"small",round:""},{default:$(()=>[a("span",{class:"cursor-pointer",onClick:f[7]||(f[7]=T=>x())},g(i.$t("video.clear")),1)]),_:1})):b("",!0)]),a("div",null,[y(m(A),{loading:t.value.isDo,type:"primary",disabled:!m(r),onClick:f[8]||(f[8]=T=>j())},{default:$(()=>[y(m(N),{icon:"ri:video-add-line"}),S(" "+g(i.$t("video.generate")),1)]),_:1},8,["loading","disabled"])])])]),m(c)?(o(),d("div",{key:2,class:"pt-2 text-[12px]",innerHTML:i.$t("video.lumainfo")},null,8,Qe)):b("",!0)])}}});class he{constructor(){te(this,"localKey","runway-store")}save(e){if(!e.id)throw"taskID must";let t=this.getObjs(),s=t.findIndex(w=>w.id==e.id);return s>-1?t[s]=e:t.push(e),H.set(this.localKey,t),this}findIndex(e){return this.getObjs().findIndex(t=>t.id==e)}getObjs(){const e=H.get(this.localKey);return e||[]}getOneById(e){const t=this.findIndex(e);return t<0?null:this.getObjs()[t]}}function tt(){let l={};if(h.myData.vtoken){const t={"x-vtoken":h.myData.vtoken,"x-ctoken":h.myData.ctoken};l={...l,...t}}if(!R.myData.RUNWAY_KEY){const t=oe();if(t.token){const s={"x-ptoken":t.token};return l={...l,...s},l}return l}const e={Authorization:"Bearer "+R.myData.RUNWAY_KEY};return l={...l,...e},l}const at=l=>{if(l.indexOf("http")==0)return l;const e=l.indexOf("/pro")>-1?"/pro":"";return l=l.replaceAll("/pro",""),R.myData.RUNWAY_SERVER?R.myData.RUNWAY_SERVER.indexOf("/pro")>0?`${R.myData.RUNWAY_SERVER}/runway${l}`:`${R.myData.RUNWAY_SERVER}${e}/runway${l}`:`${e}/runway${l}`},W=(l,e,t)=>{D("runwayFetch",l);let s=t!=null&&t.upFile?{}:{"Content-Type":"application/json"};return t&&t.headers&&(s=t.headers),s={...s,...tt()},new Promise((w,u)=>{let _={method:"GET"};_.headers=s,t!=null&&t.upFile?(_.method="POST",_.body=e):e&&(_.body=JSON.stringify(e),_.method="POST"),fetch(at(l),_).then(async r=>{var j;if(!r.ok){let p="发生错误: "+r.status;try{let v=await r.json();p="("+r.status+")发生错误: "+(((j=v==null?void 0:v.error)==null?void 0:j.message)??"")}catch{}throw h.myData.ms&&h.myData.ms.error(p),new Error(p)}r.json().then(p=>w(p)).catch(p=>{h.myData.ms&&h.myData.ms.error("发生错误"+p),u(p)})}).catch(r=>{r.name==="TypeError"&&r.message==="Failed to fetch"?h.myData.ms&&h.myData.ms.error("跨域|CORS error"):h.myData.ms&&h.myData.ms.error("发生错误:"+r),D("e",r.stat),u(r)})})},se=async l=>{const e=new he;for(let t=0;t<200;t++){try{let s=await W("/tasks/"+l),w=s.task;if(w.last_feed=new Date().getTime(),D("a",s.task),e.save(w),h.setMyData({act:"RunwayFeed"}),s.task.status=="FAILED"||s.task.status=="SUCCEEDED")break}catch{}await q(5200)}},st=async(l,e)=>{let t={filename:l.name,numberOfParts:1,type:e};const s=await W("/uploads",t);if(D("runwayUpload",s),(await fetch(s.uploadUrls[0],{method:"PUT",body:l,headers:{"Content-Type":s.uploadHeaders["Content-Type"],Accept:"/","Accept-Language":"zh-CN,zh;q=0.9",Connection:"keep-alive"}})).status!=200)throw"upload file faile";let u={parts:[{PartNumber:1,ETag:"ca3b00c313b6fd9a5c48889ad16f7d5e"}]};const _=await W(`/uploads/${s.id}/complete`,u);return D("runwayUpload2",_),_},ot={class:"px-2"},lt={class:"pt-1"},it={class:"pt-1"},nt={key:0,class:"pt-1"},rt={class:"flex justify-between items-center"},dt={class:"line-clamp-1"},ut={class:"max-w-[300px]"},ct={key:0},pt={key:1},vt={key:2},mt={key:3},_t={key:4,class:"max-w-[300px]"},ft={class:"max-w-[300px]"},gt={class:"relative flex items-center justify-center bg-white bg-opacity-10 rounded-[5px] overflow-hidden aspect-[16/8.85]"},yt=["poster"],ht=["src"],kt={key:1,class:"pt-1"},wt={class:"pt-1"},$t={class:"flex justify-between items-end"},bt=["src"],xt={key:2,class:"text-center"},Dt={class:"text-right"},jt={class:"pb-1 text-right"},It=["innerHTML"],Rt=M({__name:"runwayInput",setup(l){const e=I(),t=I({image_prompt:"",seed:1675247627,text_prompt:""}),s=I({isDo:!1,uploading:!1,version:"gen2",time:5}),w=J(),u=I();async function _(k){D("selectFile",k.target.files[0]);const n=k.target.files[0];s.value.uploading=!0;try{let i=await st(n,"DATASET_PREVIEW");D("runwayFetch",i),t.value.image_prompt=i.url}catch(i){w.error(i)}s.value.uploading=!1}function r(k,n){return k=Math.ceil(k),n=Math.floor(n),Math.floor(Math.random()*(n-k+1))+k}const j=Y(()=>(t.value.image_prompt!=""||t.value.text_prompt!="")&&!s.value.isDo),p=async()=>{s.value.isDo=!0;let k=r(1375247627,3975247627);try{let n={taskType:"gen2",internal:!1,options:{name:`Gen-2 ${k}`,seconds:4,gen2Options:{mode:"gen2",seed:k,interpolate:!0,upscale:!1,watermark:!0,motion_score:22,use_motion_score:!0,use_motion_vectors:!1,text_prompt:t.value.text_prompt,image_prompt:t.value.image_prompt,init_image:t.value.image_prompt},exploreMode:!1,assetGroupName:"Generative Video"}},i={taskType:"europa",internal:!1,options:{name:`Gen-3 Alpha  ${k}`,seconds:s.value.time,text_prompt:t.value.text_prompt,seed:k,exploreMode:!0,watermark:!1,enhance_prompt:!0,width:1280,height:768,assetGroupName:"Generative Video",init_image:t.value.image_prompt,resolution:"720p",extended_from_task_id:u.value&&u.value.id?u.value.id:void 0,init_video:u.value&&u.value.artifacts&&u.value.artifacts[0].url?u.value.artifacts[0].url:void 0}},f={taskType:"gen3a_turbo",internal:!1,options:{name:`Gen-3 Alpha Turbo ${k}`,seconds:s.value.time,text_prompt:t.value.text_prompt,seed:k,exploreMode:!1,watermark:!1,enhance_prompt:!0,init_image:t.value.image_prompt,resolution:"720p",image_as_end_frame:!1,assetGroupName:"Generative Video",extended_from_task_id:u.value&&u.value.id?u.value.id:void 0,init_video:u.value&&u.value.artifacts&&u.value.artifacts[0].url?u.value.artifacts[0].url:void 0}};n.options.gen2Options.image_prompt==""&&(delete n.options.gen2Options.image_prompt,delete n.options.gen2Options.init_image),i.options.init_image==""&&(delete i.options.init_image,delete f.options.init_image),i.options.init_video||(delete i.options.init_video,delete f.options.init_video),i.options.extended_from_task_id||(delete i.options.extended_from_task_id,delete f.options.extended_from_task_id),i.options.exploreMode=s.value.version=="europa";let C=i;if(s.value.version=="gen2"&&(C=n),s.value.version=="gen3a_turbo"&&(C=f,f.options.init_image=="")){w.error(O("video.gen3a_turbo_img"));return}const E=await W("/tasks",C);D("runwayGen2",E),E.task&&E.task.id&&se(E.task.id)}catch(n){w.error(n)}s.value.isDo=!1},v=[{label:O("video.rwgen2"),value:"gen2"},{label:O("video.rwgen3"),value:"europa"},{label:O("video.rwgen3fast"),value:"europa-fast"},{label:O("video.rwgen3turbo"),value:"gen3a_turbo"}],x=[{label:"Duration: 5s",value:5},{label:"Duration: 10s",value:10}],c=()=>{t.value.image_prompt="",t.value.text_prompt="",u.value=void 0};return z(()=>s.value.version,k=>{R.setMyData({RRUNWAY_VERSION:k})}),X(()=>{h.setMyData({ms:w}),s.value.version=R.myData.RRUNWAY_VERSION?R.myData.RRUNWAY_VERSION:"gen2"}),z(()=>h.myData.act,k=>{k=="runway.extend"&&(D("runway.extend",h.myData.actData),u.value=h.myData.actData)}),(k,n)=>(o(),d("div",ot,[a("div",lt,[y(m(G),{value:s.value.version,"onUpdate:value":n[0]||(n[0]=i=>s.value.version=i),options:v,size:"small"},null,8,["value"])]),a("div",it,[y(m(K),{value:t.value.text_prompt,"onUpdate:value":n[1]||(n[1]=i=>t.value.text_prompt=i),placeholder:k.$t("video.descpls"),type:"textarea",size:"small",autosize:{minRows:3,maxRows:12}},null,8,["value","placeholder"])]),u.value?(o(),d("div",nt,[a("div",rt,[a("div",null,[y(m(Z),{trigger:"hover"},{trigger:$(()=>{var i;return[a("div",dt,[S(g(k.$t("video.extend"))+": ",1),u.value.options.text_prompt?(o(),d(U,{key:0},[S(g(u.value.options.text_prompt),1)],64)):(o(),d(U,{key:1},[S(g((i=u.value.options.gen2Options)!=null&&i.text_prompt?u.value.options.gen2Options.text_prompt:u.value.name),1)],64))])]}),default:$(()=>{var i;return[a("div",ut,g(u.value.id),1),u.value.taskType=="gen3a"?(o(),d("div",ct,"Version: Gen-3")):b("",!0),u.value.taskType=="gen3a_turbo"?(o(),d("div",pt,"Version: Gen-3-turbo")):b("",!0),u.value.taskType=="gen2"?(o(),d("div",vt,"Version: Gen-2")):b("",!0),u.value.createdAt?(o(),d("div",mt,"createdAt: "+g(new Date(u.value.createdAt).toLocaleString()),1)):b("",!0),u.value.options.text_prompt?(o(),d("div",_t,g(u.value.options.text_prompt),1)):b("",!0),a("div",ft,g((i=u.value.options.gen2Options)!=null&&i.text_prompt?u.value.options.gen2Options.text_prompt:u.value.name),1)]}),_:1})])]),a("div",gt,[u.value.artifacts&&u.value.artifacts[0].url?(o(),d("video",{key:0,loop:"",playsinline:"",controls:"",referrerpolicy:"no-referrer",poster:u.value.artifacts[0].previewUrls[0],class:"w-full h-full object-cover"},[a("source",{src:u.value.artifacts[0].url,referrerpolicy:"no-referrer",type:"video/mp4"},null,8,ht)],8,yt)):b("",!0)])])):b("",!0),s.value.version!="gen2"?(o(),d("div",kt,[y(m(G),{value:s.value.time,"onUpdate:value":n[2]||(n[2]=i=>s.value.time=i),options:x,size:"small"},null,8,["value"])])):b("",!0),a("div",wt,[a("div",$t,[a("div",null,[a("input",{type:"file",onChange:_,ref_key:"fsRef",ref:e,style:{display:"none"},accept:"image/jpeg, image/jpg, image/png, image/gif"},null,544),a("div",{class:"h-[80px] w-[80px] overflow-hidden rounded-sm border border-gray-400/20 flex justify-center items-center cursor-pointer",onClick:n[3]||(n[3]=i=>e.value.click())},[s.value.uploading?(o(),L(m(N),{key:0,icon:"line-md:uploading-loop",class:"text-[60px] text-green-300"})):t.value.image_prompt?(o(),d("img",{key:1,src:t.value.image_prompt},null,8,bt)):(o(),d("div",xt,g(k.$t("video.selectimg")),1))])]),a("div",Dt,[a("div",jt,[t.value.text_prompt!=""||t.value.image_prompt!=""||u.value?(o(),L(m(Q),{key:0,type:"success",size:"small",round:""},{default:$(()=>[a("span",{class:"cursor-pointer",onClick:n[4]||(n[4]=i=>c())},g(k.$t("video.clear")),1)]),_:1})):b("",!0)]),y(m(A),{loading:s.value.isDo,type:"primary",disabled:!m(j),onClick:n[5]||(n[5]=i=>p())},{default:$(()=>[y(m(N),{icon:"ri:video-add-line"}),S(" "+g(k.$t("video.generate")),1)]),_:1},8,["loading","disabled"])])])]),a("div",{class:"pt-2 text-[12px]",innerHTML:k.$t("video.runwayinfo")},null,8,It)]))}});class ke{constructor(){te(this,"localKey","kling-store")}save(e){if(!e.data.task_id)throw"taskID must";let t=this.getObjs(),s=t.findIndex(w=>w.data.task_id==e.data.task_id);return s>-1?t[s]=e:t.push(e),H.set(this.localKey,t),this}findIndex(e){return this.getObjs().findIndex(t=>t.data.task_id==e)}getObjs(){const e=H.get(this.localKey);return e||[]}getOneById(e){const t=this.findIndex(e);return t<0?null:this.getObjs()[t]}}function St(){let l={};if(h.myData.vtoken){const t={"x-vtoken":h.myData.vtoken,"x-ctoken":h.myData.ctoken};l={...l,...t}}if(!R.myData.KLING_KEY){const t=oe();if(t.token){const s={"x-ptoken":t.token};return l={...l,...s},l}return l}const e={Authorization:"Bearer "+R.myData.KLING_KEY};return l={...l,...e},l}const Ct=l=>{if(l.indexOf("http")==0)return l;const e="";return l=l.replaceAll("/pro",""),R.myData.KLING_SERVER?`${R.myData.RUNWAY_SERVER}${e}/kling${l}`:`${e}/kling${l}`},re=(l,e,t)=>{D("runwayFetch",l);let s=t!=null&&t.upFile?{}:{"Content-Type":"application/json"};return t&&t.headers&&(s=t.headers),s={...s,...St()},new Promise((w,u)=>{let _={method:"GET"};_.headers=s,t!=null&&t.upFile?(_.method="POST",_.body=e):e&&(_.body=JSON.stringify(e),_.method="POST"),fetch(Ct(l),_).then(async r=>{var j;if(!r.ok){let p="发生错误: "+r.status;try{let v=await r.json();p="("+r.status+")发生错误: "+(((j=v==null?void 0:v.error)==null?void 0:j.message)??"")}catch{}throw h.myData.ms&&h.myData.ms.error(p),new Error(p)}r.json().then(p=>w(p)).catch(p=>{h.myData.ms&&h.myData.ms.error("发生错误"+p),u(p)})}).catch(r=>{r.name==="TypeError"&&r.message==="Failed to fetch"?h.myData.ms&&h.myData.ms.error("跨域|CORS error"):h.myData.ms&&h.myData.ms.error("发生错误:"+r),D("e",r.stat),u(r)})})},de=async(l,e,t)=>{const s=new ke;let w="/v1/images/generations/";e=="text2video"&&(w="/v1/videos/text2video/"),e=="image2video"&&(w="/v1/videos/image2video/"),w=w+l;for(let u=0;u<200;u++){try{let r=await re(w);if(r.last_feed=new Date().getTime(),r.cat=e,t&&(r.prompt=t),s.save(r),h.setMyData({act:"KlingFeed"}),r.data.task_status=="failed"||r.data.task_status=="succeed")break}catch{break}await q(5200)}},Et={class:"overflow-y-auto h-full"},Ot={class:"mb-4"},Tt={class:"flex items-center justify-between space-x-1"},Lt=["onClick"],At={class:"aspect-box-wrapper mx-auto my-2 flex h-5 w-5 items-center justify-center"},Ut={class:"mb-1 text-center text-sm"},Mt={class:"mb-4 flex justify-between items-center"},Vt={class:"mb-4 flex justify-between items-center"},zt={class:"mb-4 flex justify-between items-center"},Nt={class:"mb-4 flex justify-between items-center"},Ft={class:"mb-4 flex justify-between items-center"},Gt={class:"mb-4"},Kt={class:"flex justify-start items-end"},Pt=["src"],Bt={key:1,class:"text-center"},Yt={class:"pl-2"},Ht=["src"],Wt={key:1,class:"text-center"},qt={class:"mb-4 flex justify-between items-end"},Jt={class:"relative"},Xt={class:"cursor-pointer"},Zt={class:"text-right"},Qt=["innerHTML"],ea=M({__name:"kgInputVideo",setup(l){const e=I({prompt:"",negative_prompt:"",image:"",image_tail:"",aspect_ratio:"1:1",mode:"std",duration:"5"}),t=I({bili:0,isLoading:!1,camera_type:""}),s=I(),w=I(),u=J(),_=[{s:"width: 100%; height: 100%;",label:"1:1",value:"1:1"},{s:"width: 100%; height: 50%;",label:"16:9",value:"16:9"},{s:"width: 50%; height: 100%;",label:"9:16",value:"9:16"}],r=[{label:O("mj.std"),value:"std"},{label:O("mj.pro"),value:"pro"}],j=[{label:"5s",value:"5"},{label:"10s",value:"10"}],p=[{label:O("mj.cnull"),value:""},{label:O("mj.down_back"),value:"down_back"},{label:O("mj.forward_up"),value:"forward_up"},{label:O("mj.right_turn_forward"),value:"right_turn_forward"},{label:O("mj.left_turn_forward"),value:"left_turn_forward"}];function v(n){B(n.target.files[0]).then(i=>{e.value.image=i,s.value=""}).catch(i=>u.error(i))}function x(n){B(n.target.files[0]).then(i=>{e.value.image_tail=i,w.value="",e.value.image==""&&u.info(O("mj.needImg"))}).catch(i=>u.error(i))}const c=()=>{e.value.prompt="",e.value.image="",e.value.image_tail="",s.value="",w.value=""},k=async()=>{t.value.isLoading=!0,e.value.aspect_ratio=_[t.value.bili].value;try{let n="text2video",i={...e.value};e.value.image!=""?(n="image2video",i.image=ae(i.image),e.value.image_tail&&(i.image_tail=ae(e.value.image_tail))):t.value.camera_type&&(i.camera_control={type:t.value.camera_type});const f=await re("/v1/videos/"+n,i);D("img",f),de(f.data.task_id,n,e.value.prompt)}catch{}t.value.isLoading=!1};return X(()=>{h.setMyData({ms:u})}),(n,i)=>(o(),d("div",Et,[a("section",Ot,[a("div",Tt,[(o(),d(U,null,ee(_,(f,C)=>a("section",{class:le(["aspect-item flex-1 rounded border-2 dark:border-neutral-700 cursor-pointer",{active:C==t.value.bili}]),onClick:E=>t.value.bili=C},[a("div",At,[a("div",{class:"aspect-box rounded border-2 dark:border-neutral-700",style:ve(f.s)},null,4)]),a("p",Ut,g(f.label),1)],10,Lt)),64))])]),a("section",Mt,[a("div",null,g(n.$t("mj.mode")),1),y(m(G),{value:e.value.mode,"onUpdate:value":i[0]||(i[0]=f=>e.value.mode=f),size:"small",options:r,class:"!w-[70%]"},null,8,["value"])]),a("section",Vt,[a("div",null,g(n.$t("mj.duration")),1),y(m(G),{value:e.value.duration,"onUpdate:value":i[1]||(i[1]=f=>e.value.duration=f),size:"small",options:j,class:"!w-[70%]"},null,8,["value"])]),a("section",zt,[a("div",null,g(n.$t("mj.camera_type")),1),y(m(G),{value:t.value.camera_type,"onUpdate:value":i[2]||(i[2]=f=>t.value.camera_type=f),size:"small",options:p,class:"!w-[70%]"},null,8,["value"])]),a("section",Nt,[a("div",null,g(n.$t("mj.nohead")),1),y(m(K),{modelValue:e.value.negative_prompt,"onUpdate:modelValue":i[3]||(i[3]=f=>e.value.negative_prompt=f),size:"small",class:"!w-[70%]",clearable:"",placeholder:n.$t("mj.negative_prompt")},null,8,["modelValue","placeholder"])]),a("section",Ft,[y(m(K),{value:e.value.prompt,"onUpdate:value":i[4]||(i[4]=f=>e.value.prompt=f),placeholder:n.$t("video.descpls"),type:"textarea",size:"small",autosize:{minRows:3,maxRows:12}},null,8,["value","placeholder"])]),a("div",Gt,[a("div",Kt,[a("div",null,[a("input",{type:"file",onChange:v,ref_key:"fsRef",ref:s,style:{display:"none"},accept:"image/jpeg, image/jpg, image/png, image/gif"},null,544),a("div",{class:"h-[80px] w-[80px] overflow-hidden rounded-sm border border-gray-400/20 flex justify-center items-center cursor-pointer",onClick:i[5]||(i[5]=f=>s.value.click())},[e.value.image?(o(),d("img",{key:0,src:e.value.image},null,8,Pt)):(o(),d("div",Bt,g(n.$t("video.selectimg")),1))])]),a("div",Yt,[a("input",{type:"file",onChange:x,ref_key:"fsRef2",ref:w,style:{display:"none"},accept:"image/jpeg, image/jpg, image/png, image/gif"},null,544),a("div",{class:"h-[80px] w-[80px] overflow-hidden rounded-sm border border-gray-400/20 flex justify-center items-center cursor-pointer",onClick:i[6]||(i[6]=f=>w.value.click())},[e.value.image_tail?(o(),d("img",{key:0,src:e.value.image_tail},null,8,Ht)):(o(),d("div",Wt,g(n.$t("video.endImg")),1))])])])]),a("section",qt,[a("div",Jt,[e.value.image||e.value.prompt||e.value.image_tail?(o(),d("div",{key:0,class:"cursor-pointer pb-2",onClick:c},[y(m(Q),{type:"success",size:"small",bordered:!1,round:""},{default:$(()=>[a("span",Xt,g(n.$t("video.clear")),1)]),_:1})])):b("",!0)]),a("div",Zt,[y(m(A),{loading:t.value.isLoading,type:"primary",onClick:i[7]||(i[7]=f=>k()),disabled:!e.value.prompt},{default:$(()=>[S(g(n.$t("video.generate")),1)]),_:1},8,["loading","disabled"])])]),a("ul",{class:"text-[12px]",innerHTML:n.$t("mj.klingInfo")},null,8,Qt)]))}}),ta={class:"overflow-y-auto bg-[#fafbfc] dark:bg-[#18181c] h-full"},aa={class:"mb-4"},sa={class:"flex items-center justify-between space-x-1"},oa=["onClick"],la={class:"aspect-box-wrapper mx-auto my-2 flex h-5 w-5 items-center justify-center"},ia={class:"mb-1 text-center text-sm"},na={class:"mb-4 flex justify-between items-center"},ra={class:"mb-4 flex justify-between items-center"},da={class:"mb-4 flex justify-between items-end"},ua={class:"relative"},ca=["src"],pa={key:1,class:"text-center"},va={class:"text-right"},ma={class:"cursor-pointer"},_a=M({__name:"kgInputImage",setup(l){const e=I({prompt:"",negative_prompt:"",image:"",image_fidelity:.5,n:1,aspect_ratio:"1:1"}),t=I({bili:0,isLoading:!1}),s=I(),w=J(),u=[{s:"width: 100%; height: 100%;",label:"1:1",value:"1:1"},{s:"width: 100%; height: 75%;",label:"4:3",value:"4:3"},{s:"width: 75%; height: 100%;",label:"3:4",value:"3:4"},{s:"width: 100%; height: 50%;",label:"16:9",value:"16:9"},{s:"width: 50%; height: 100%;",label:"9:16",value:"9:16"}];function _(p){B(p.target.files[0]).then(v=>{e.value.image=v,s.value=""}).catch(v=>w.error(v))}const r=()=>{e.value.prompt="",e.value.image="",s.value=""},j=async()=>{t.value.isLoading=!0,e.value.aspect_ratio=u[t.value.bili].value;let p={...e.value};p.image&&(p.image=ae(p.image));try{const v=await re("/v1/images/generations ",p);D("img",v),de(v.data.task_id,"image",e.value.prompt)}catch{}t.value.isLoading=!1};return X(()=>{h.setMyData({ms:w})}),(p,v)=>(o(),d("div",ta,[a("section",aa,[a("div",sa,[(o(),d(U,null,ee(u,(x,c)=>a("section",{class:le(["aspect-item flex-1 rounded border-2 dark:border-neutral-700 cursor-pointer",{active:c==t.value.bili}]),onClick:k=>t.value.bili=c},[a("div",la,[a("div",{class:"aspect-box rounded border-2 dark:border-neutral-700",style:ve(x.s)},null,4)]),a("p",ia,g(x.label),1)],10,oa)),64))])]),a("section",na,[a("div",null,g(p.$t("mj.nohead")),1),y(m(K),{modelValue:e.value.negative_prompt,"onUpdate:modelValue":v[0]||(v[0]=x=>e.value.negative_prompt=x),size:"small",class:"!w-[70%]",clearable:"",placeholder:p.$t("mj.negative_prompt")},null,8,["modelValue","placeholder"])]),a("section",ra,[y(m(K),{value:e.value.prompt,"onUpdate:value":v[1]||(v[1]=x=>e.value.prompt=x),placeholder:p.$t("mj.ideopls"),type:"textarea",size:"small",autosize:{minRows:3,maxRows:12}},null,8,["value","placeholder"])]),a("section",da,[a("div",ua,[a("input",{type:"file",onChange:_,ref_key:"fsRef",ref:s,style:{display:"none"},accept:"image/jpeg, image/jpg, image/png, image/gif"},null,544),a("div",{class:"h-[80px] w-[80px] overflow-hidden rounded-sm border border-gray-400/20 flex justify-center items-center cursor-pointer",onClick:v[2]||(v[2]=x=>s.value.click())},[e.value.image?(o(),d("img",{key:0,src:e.value.image},null,8,ca)):(o(),d("div",pa,g(p.$t("video.selectimg")),1))])]),a("div",va,[e.value.image||e.value.prompt?(o(),d("div",{key:0,class:"cursor-pointer pb-2",onClick:r},[y(m(Q),{type:"success",size:"small",bordered:!1,round:""},{default:$(()=>[a("span",ma,g(p.$t("video.clear")),1)]),_:1})])):b("",!0),y(m(A),{loading:t.value.isLoading,type:"primary",onClick:v[3]||(v[3]=x=>j()),disabled:!e.value.prompt},{default:$(()=>[S(g(p.$t("mjchat.imgcreate")),1)]),_:1},8,["loading","disabled"])])])]))}}),fa={class:"px-2"},ga=M({__name:"kgInput",setup(l){return(e,t)=>(o(),d("div",fa,[y(m(me),{type:"segment",animated:"",size:"small","default-value":"video"},{default:$(()=>[y(m(F),{name:"video",tab:e.$t("video.menu")},{default:$(()=>[y(ea)]),_:1},8,["tab"]),y(m(F),{name:"image",tab:e.$t("mjchat.draw")},{default:$(()=>[y(_a)]),_:1},8,["tab"])]),_:1})]))}}),ya=M({__name:"voInput",setup(l){const e=t=>{D("handleUpdateValue",t),R.setMyData({TAB_VIDEO:t})};return(t,s)=>(o(),L(m(me),{type:"line",animated:"","default-value":m(R).myData.TAB_VIDEO,"onUpdate:value":e},{default:$(()=>[y(m(F),{name:"",tab:""}),y(m(F),{name:"luma",tab:"Luma"},{default:$(()=>[y(et)]),_:1}),y(m(F),{name:"runway",tab:"Runway"},{default:$(()=>[y(Rt)]),_:1}),y(m(F),{name:"kling",tab:t.$t("mj.kling")},{default:$(()=>[y(ga)]),_:1},8,["tab"])]),_:1},8,["default-value"]))}}),ha={key:0,class:"p-4"},ka={class:"grid grid-cols-1 gap-5 md:grid-cols-2 lg:grid-cols-3"},wa=["onMousemove"],$a={class:"relative flex items-center justify-center bg-white bg-opacity-10 rounded-[16px] overflow-hidden aspect-[16/8.85]"},ba=["src","onError","controls"],xa={key:1,class:"text-center"},Da={key:0,class:"pt-2"},ja={key:2,class:"pt-2"},Ia={key:0},Ra={key:1},Sa={class:"flex justify-between items-center"},Ca={class:"line-clamp-1"},Ea={key:0},Oa={key:1},Ta={class:"max-w-[300px]"},La={key:0,class:"flex justify-end items-center pt-1"},Aa={key:1,class:"w-full h-full flex justify-center items-center"},Ua=M({__name:"voList",setup(l){const e=I({pIndex:-1}),t=I([]),s=new _e,w=()=>{let r=s.getObjs();t.value=r.reverse()};Y(()=>new Date().getTime());const u=async r=>{var x,c;let j=r.id,p="";try{let k=await ne("/generations/"+j+"/download_video_url");D("d",k),p=k.url??((x=r.video)==null?void 0:x.url)}catch{p=((c=r.video)==null?void 0:c.url)??""}const v=document.createElement("a");v.href=p,v.download=j+".mp4",v.target="_blank",document.body.appendChild(v),v.click(),document.body.removeChild(v)},_=async r=>{D("extend ",r),h.setMyData({act:"luma.extend",actData:r})};return z(()=>h.myData.act,r=>{r=="FeedLumaTask"&&w()}),w(),(r,j)=>t.value.length>0?(o(),d("div",ha,[a("div",ka,[(o(!0),d(U,null,ee(t.value,(p,v)=>{var x,c,k,n,i,f,C;return o(),d("div",{key:v,class:"relative",onMousemove:E=>e.value.pIndex=v,onMouseout:j[0]||(j[0]=E=>e.value.pIndex=-1)},[a("div",$a,[(x=p.video)!=null&&x.url||(c=p.video)!=null&&c.download_url?(o(),d("video",{key:0,src:(k=p.video)!=null&&k.download_url?(n=p.video)==null?void 0:n.download_url:(i=p.video)==null?void 0:i.url,onError:E=>{var V;return E.target.src=(V=p.video)==null?void 0:V.url},loop:"",playsinline:"",controls:e.value.pIndex==v,class:"w-full h-full object-cover"},null,40,ba)):(o(),d("div",xa,[p.state=="failed"?(o(),d("div",Da,g(r.$t("video.failed")),1)):!p.last_feed||new Date().getTime()-p.last_feed>20*1e3?(o(),L(m(A),{key:1,size:"small",type:"primary",onClick:E=>m(ye)(p.id)},{default:$(()=>[S(g(r.$t("video.repeat")),1)]),_:2},1032,["onClick"])):(o(),d("div",ja,[a("div",null,g(r.$t("video.process"))+g(new Date(p.last_feed).toLocaleString()),1),p.state=="pending"?(o(),d("div",Ia,g(r.$t("video.pending")),1)):b("",!0),p.state=="processing"?(o(),d("div",Ra,g(r.$t("video.processing")),1)):b("",!0)]))]))]),a("div",Sa,[a("div",null,[y(m(Z),{trigger:"hover"},{trigger:$(()=>[a("div",Ca,g(p.prompt),1)]),default:$(()=>[p.id?(o(),d("div",Ea,"ID: "+g(p.id),1)):b("",!0),p.created_at?(o(),d("div",Oa,"createdAt: "+g(new Date(p.created_at).toLocaleString()),1)):b("",!0),a("div",Ta,g(p.prompt),1)]),_:2},1024)]),(f=p.video)!=null&&f.url||(C=p.video)!=null&&C.download_url?(o(),d("div",La,[y(m(ge),{size:"tiny"},{default:$(()=>[y(m(A),{size:"tiny",round:"",ghost:"",onClick:E=>u(p)},{default:$(()=>[y(m(N),{icon:"mdi:download"}),S(" "+g(r.$t("video.download")),1)]),_:2},1032,["onClick"]),y(m(A),{size:"tiny",round:"",ghost:"",onClick:E=>_(p)},{default:$(()=>[y(m(N),{icon:"ri:video-add-line"}),S(" "+g(r.$t("video.extend")),1)]),_:2},1032,["onClick"])]),_:2},1024)])):b("",!0)])],40,wa)}),128))])])):(o(),d("div",Aa,[y(m(ie),{description:r.$t("video.nodata")},null,8,["description"])]))}}),Ma={key:0,class:"p-4"},Va={class:"grid grid-cols-1 gap-5 md:grid-cols-2 lg:grid-cols-3"},za=["onMousemove"],Na={class:"relative flex items-center justify-center bg-white bg-opacity-10 rounded-[16px] overflow-hidden aspect-[16/8.85]"},Fa={key:0},Ga=["controls","poster","onError"],Ka=["src"],Pa={key:1,class:"text-center"},Ba={key:0,class:"pt-2"},Ya={class:"line-clamp-3"},Ha={key:2,class:"pt-2"},Wa={key:0},qa={key:1},Ja={class:"flex justify-between items-center"},Xa={class:"line-clamp-1"},Za={key:0},Qa={key:1},es={key:2},ts={key:3},as={key:4},ss={key:5,class:"max-w-[300px]"},os={class:"max-w-[300px]"},ls={key:0,class:"flex justify-end items-center pt-1"},is={key:1,class:"w-full h-full flex justify-center items-center"},ns=M({__name:"runwayList",setup(l){const e=I(new Map),t=I({pIndex:-1}),s=I([]),w=new he,u=()=>{let v=w.getObjs();s.value=v.reverse()},_=v=>{if(D("RunwayTaskDown",v),!v.artifacts||v.artifacts.length==0)return;const x=document.createElement("a");x.href=v.artifacts[0].url,x.download=v.id+".mp4",x.target="_blank",x.rel="noreferrer",document.body.appendChild(x),x.click(),document.body.removeChild(x)},r=v=>{D("extend ",v),h.setMyData({act:"runway.extend",actData:v})};z(()=>h.myData.act,v=>{v=="RunwayFeed"&&u()});const j=(v,x)=>{D("videoError",x,v),e.value.set(v.id,x+1)},p=async v=>{await se(v),e.value.delete(v)};return u(),(v,x)=>s.value.length>0?(o(),d("div",Ma,[a("div",Va,[(o(!0),d(U,null,ee(s.value,(c,k)=>(o(),d("div",{key:k,class:"relative",onMousemove:n=>t.value.pIndex=k,onMouseout:x[0]||(x[0]=n=>t.value.pIndex=-1)},[a("div",Na,[c.artifacts&&c.artifacts.length>0&&c.artifacts[0].url?(o(),d(U,{key:0},[e.value.has(c.id)?(o(),d("div",Fa,[y(m(A),{size:"small",type:"primary",onClick:n=>p(c.id)},{default:$(()=>[S(g(v.$t("video.repeat2")),1)]),_:2},1032,["onClick"])])):(o(),d("video",{key:1,loop:"",playsinline:"",controls:t.value.pIndex==k,referrerpolicy:"no-referrer",poster:c.artifacts[0].previewUrls[0],class:"w-full h-full object-cover",onError:n=>j(c,k)},[t.value.pIndex==k?(o(),d("source",{key:0,src:c.artifacts[0].url,referrerpolicy:"no-referrer",type:"video/mp4"},null,8,Ka)):b("",!0)],40,Ga))],64)):(o(),d("div",Pa,[c.status=="FAILED"?(o(),d("div",Ba,[a("div",null,g(v.$t("video.failed")),1),a("div",Ya,g(c.progressText),1)])):!c.last_feed||new Date().getTime()-c.last_feed>20*1e3?(o(),L(m(A),{key:1,size:"small",type:"primary",onClick:n=>m(se)(c.id)},{default:$(()=>[S(g(v.$t("video.repeat")),1)]),_:2},1032,["onClick"])):(o(),d("div",Ha,[a("div",null,g(v.$t("video.process"))+g(new Date(c.last_feed).toLocaleString()),1),c.progressRatio?(o(),d("div",Wa,g((parseFloat(c.progressRatio)*100).toFixed(0))+"%",1)):c.estimatedTimeToStartSeconds&&c.estimatedTimeToStartSeconds>0?(o(),d("div",qa,g(c.estimatedTimeToStartSeconds.toFixed(1))+"秒后开始执行",1)):b("",!0)]))]))]),a("div",Ja,[a("div",null,[y(m(Z),{trigger:"hover"},{trigger:$(()=>{var n;return[a("div",Xa,[c.options.text_prompt?(o(),d(U,{key:0},[S(g(c.options.text_prompt),1)],64)):(o(),d(U,{key:1},[S(g((n=c.options.gen2Options)!=null&&n.text_prompt?c.options.gen2Options.text_prompt:c.name),1)],64))])]}),default:$(()=>{var n;return[c.id?(o(),d("div",Za,"ID: "+g(c.id),1)):b("",!0),c.taskType=="gen3a"?(o(),d("div",Qa,"Version: Gen-3")):b("",!0),c.taskType=="gen3a_turbo"?(o(),d("div",es,"Version: Gen-3-turbo")):b("",!0),c.taskType=="gen2"?(o(),d("div",ts,"Version: Gen-2")):b("",!0),c.createdAt?(o(),d("div",as,"createdAt: "+g(new Date(c.createdAt).toLocaleString()),1)):b("",!0),c.options.text_prompt?(o(),d("div",ss,g(c.options.text_prompt),1)):b("",!0),a("div",os,g((n=c.options.gen2Options)!=null&&n.text_prompt?c.options.gen2Options.text_prompt:c.name),1)]}),_:2},1024)]),c.artifacts&&c.artifacts.length>0&&c.artifacts[0].url?(o(),d("div",ls,[y(m(ge),{size:"tiny"},{default:$(()=>[y(m(A),{size:"tiny",round:"",ghost:"",onClick:n=>_(c)},{default:$(()=>[y(m(N),{icon:"mdi:download"}),S(" "+g(v.$t("video.download")),1)]),_:2},1032,["onClick"]),y(m(A),{size:"tiny",round:"",ghost:"",onClick:n=>r(c)},{default:$(()=>[y(m(N),{icon:"ri:video-add-line"}),S(" "+g(v.$t("video.extend")),1)]),_:2},1032,["onClick"])]),_:2},1024)])):b("",!0)])],40,za))),128))])])):(o(),d("div",is,[y(m(ie),{description:v.$t("video.nodata")},null,8,["description"])]))}}),rs=M({__name:"kgImage",props:{item:null},emits:["kgSuccess","kgClick"],setup(l,{emit:e}){const t=l,s=I({uri_base64:"",isLoad:!1});return(async()=>{if(D("kg-Image",t.item),t.item.task&&t.item.task.request_id&&t.item.src){let u="kg:"+t.item.task.request_id;D("key>> ",u);try{let _=await xe(u);if(!_){const r=await De(`https://wsrv.nl/?url=${encodeURIComponent(t.item.src)}`,u);_=r.base64,D("图片已保存>>",r.key)}_&&(s.value.uri_base64=_)}catch(_){D("图片保存失败",_)}}D("图片已保存>>",s.value.uri_base64),s.value.isLoad=!0})(),(u,_)=>s.value.isLoad?(o(),L(m(be),{key:0,url:s.value.uri_base64?s.value.uri_base64:t.item.src,onSuccess:_[0]||(_[0]=r=>e("kgSuccess")),onClick:_[1]||(_[1]=r=>e("kgClick",{base64:s.value.uri_base64,src:t.item.src}))},null,8,["url"])):b("",!0)}}),ds={key:0,class:"p-4"},us={class:"bg-white dark:bg-[#24272e] rounded-md overflow-hidden cursor-pointer group/item relative"},cs={key:0},ps={class:"w-full h-[200px] justify-center items-center flex text-center"},vs=a("br",null,null,-1),ms={key:1,class:"w-full h-[200px] justify-center items-center flex"},_s={key:0,style:{"padding-bottom":"0%"}},fs=["src","controls"],gs=["href"],ys={key:2,class:"w-[200px] h-[200px]"},hs={key:3,class:"absolute top-0 left-0 right-0 bottom-0"},ks={class:"flex justify-center items-center w-full h-full"},ws={class:"p-3"},$s={class:"line-clamp-2 text-[13px]"},bs={key:1,class:"w-full h-full flex justify-center items-center"},xs=M({__name:"kgList",setup(l){const e=I([]),t=I([]),s=I({show:!0,showImg:"",isLoad:!1,pIndex:-1,isStart:!0}),w=new ke,u=()=>{let c=w.getObjs();e.value=c.reverse(),_()},_=()=>{t.value=e.value.map((c,k)=>{var i,f,C,E,V,P;let n=((C=(f=(i=c.data.task_result)==null?void 0:i.images)==null?void 0:f[0])==null?void 0:C.url)||((P=(V=(E=c.data.task_result)==null?void 0:E.videos)==null?void 0:V[0])==null?void 0:P.url)||"";return{url:n,id:c.request_id,index:k,src:n,isLoad:0,task:c}})},r={2e3:{rowPerView:6},1600:{rowPerView:5},1200:{rowPerView:4},800:{rowPerView:3},500:{rowPerView:2}},{isMobile:j}=je(),p=I(),v=c=>{j.value||(s.value.show=!0,s.value.showImg=c.base64?c.base64:c.src,Ce(()=>{var k;return(k=p.value)==null?void 0:k.click()}))};u(),z(()=>h.myData.act,c=>{c=="KlingFeed"&&(s.value.isStart=!1,u())});const x=c=>{D("item",c),de(c.task.data.task_id,c.task.cat,c.task.prompt)};return(c,k)=>(o(),d(U,null,[e.value.length>0?(o(),d("div",ds,[t.value.length?(o(),L(m(Re),{key:0,list:t.value,breakpoints:r,class:"!bg-transparent"},{item:$(({item:n,url:i,index:f})=>[a("div",us,[n.task.data.task_status=="failed"?(o(),d("div",cs,[a("div",ps,[S(g(m(O)("video.failed")),1),vs,S("ID: "+g(n.task.data.task_id),1)])])):(!n.task.last_feed||new Date().getTime()-n.task.last_feed>20*1e3)&&!n.src?(o(),d("div",ms,[y(m(A),{size:"small",type:"primary",onClick:C=>x(n)},{default:$(()=>[S(g(c.$t("video.repeat")),1)]),_:2},1032,["onClick"])])):(o(),d(U,{key:2},[n.task.cat!="image"&&n.src?(o(),d("div",_s,[n.src?(o(),d("video",{key:0,src:n.src,loop:"",playsinline:"",disableremoteplayback:"",disablepictureinpicture:"",controls:s.value.pIndex==f,class:"w-full h-full object-cover"},null,8,fs)):b("",!0),a("a",{target:"_blank",href:n.src,class:"absolute right-[10px] top-[10px] text-[20px] w-[30px] h-[30px] rounded-full bg-white/20 flex justify-center items-center"},[y(m(N),{icon:"ri:play-fill"})],8,gs)])):n.src?(o(),L(rs,{key:1,item:n,onKgSuccess:C=>n.isLoad=1,onKgClick:v},null,8,["item","onKgSuccess","onKgClick"])):(o(),d("div",ys)),!n.src||n.isLoad==0&&s.value.isStart&&n.task.cat=="image"?(o(),d("section",hs,[a("div",ks,[y(m(Ie),{size:"large"})])])):b("",!0)],64)),n.task.prompt?(o(),d("section",{key:3,class:le(["absolute w-full bottom-0 backdrop-blur-sm text-white/70",n.src?["invisible","group-hover/item:visible"]:[]])},[a("div",ws,[a("div",$s,[n.task.prompt?(o(),d(U,{key:0},[S(g(n.task.prompt),1)],64)):b("",!0)])])],2)):b("",!0)])]),_:1},8,["list"])):b("",!0)])):(o(),d("div",bs,[y(m(ie),{description:c.$t("video.nodata")},null,8,["description"])])),s.value.showImg?(o(),L(m(Se),{key:2,src:s.value.showImg,ref_key:"showImg",ref:p,width:1},null,8,["src"])):b("",!0)],64))}}),Ds={class:"flex w-full h-full"},js={class:"w-[300px] h-full overflow-y-auto"},Is={class:"flex-1 h-full bg-[#fafbfc] pt-2 dark:bg-[#18181c] overflow-y-auto"},Ts=M({__name:"video",setup(l){return(e,t)=>(o(),d("div",Ds,[a("div",js,[y(ya)]),a("div",Is,[m(R).myData.TAB_VIDEO=="runway"?(o(),L(ns,{key:0})):m(R).myData.TAB_VIDEO=="kling"?(o(),L(xs,{key:1})):(o(),L(Ua,{key:2}))])]))}});export{Ts as default};
